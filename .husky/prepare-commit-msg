#!/usr/bin/env sh

COMMIT_MESSAGE_FILE_PATH=$1
first_line=$(head -n1 "$COMMIT_MESSAGE_FILE_PATH")
remaining_lines=$(tail -n +2 "$COMMIT_MESSAGE_FILE_PATH")

# ì´ë¯¸ ì´ëª¨ì§€+íƒ€ìž… í˜•ì‹ìœ¼ë¡œ ì €ìž¥ëœ ì»¤ë°‹(ì˜ˆ: amend)ì´ë©´ ê±´ë„ˆëœë‹ˆë‹¤.
case "$first_line" in
  "âœ¨ feat"*"")   exit 0 ;;
  "ðŸ› fix"*"")    exit 0 ;;
  "âš¡ perf"*"")   exit 0 ;;
  "â™»ï¸ refactor"*"") exit 0 ;;
  "ðŸ§ª test"*"")   exit 0 ;;
  "ðŸ“ docs"*"")   exit 0 ;;
  "ðŸŽ¨ style"*"")  exit 0 ;;
  "ðŸ”§ chore"*"")  exit 0 ;;
  "ðŸš€ delopy"*"") exit 0 ;;
  "âª revert"*"") exit 0 ;;
esac

# Gitì´ ìžë™ ìƒì„±í•˜ëŠ” ë©”ì‹œì§€ëŠ” ì˜ˆì™¸ ì²˜ë¦¬
case "$first_line" in
  Merge*|Revert*|Amend*|Reset*|Rebase*|Tag*)
    exit 0
    ;;
esac

type=$(echo "$first_line" | grep -o "^[A-Za-z]*")
normalized_type=$(echo "$type" | tr 'A-Z' 'a-z')

emoji=""
case "$normalized_type" in
  feat)    emoji="âœ¨" ;;
  fix)     emoji="ðŸ›" ;;
  perf)    emoji="âš¡" ;;
  refactor) emoji="â™»ï¸" ;;
  test)    emoji="ðŸ§ª" ;;
  docs)    emoji="ðŸ“" ;;
  style)   emoji="ðŸŽ¨" ;;
  chore)   emoji="ðŸ”§" ;;
  delopy)  emoji="ðŸš€" ;;
  revert)  emoji="âª" ;;
esac

# ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ìž…ì´ë©´ ì»¤ë°‹ì„ ë§‰ê³  ê°€ì´ë“œë¥¼ ì¶œë ¥
if [ -z "$emoji" ] || [ -z "$normalized_type" ]; then
  echo "â›” ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì»¤ë°‹ íƒ€ìž…ìž…ë‹ˆë‹¤."
  echo "   ì‚¬ìš© ê°€ëŠ¥í•œ íƒ€ìž…:"
  echo "     feat, fix, perf, refactor, test, docs, style, chore, delopy, revert"
  echo "   ì˜ˆ) feat: ê¸°ëŠ¥ ì¶”ê°€ ì„¤ëª…"
  exit 1
fi

# ì²« ë²ˆì§¸ ë‹¨ì–´ë¥¼ 'ì´ëª¨ì§€ + íƒ€ìž…(ì†Œë¬¸ìž)' ë¡œ ë³€í™˜
first_line=$(echo "$first_line" | sed "s/^$type/$emoji $normalized_type/")

echo "$first_line" > "$COMMIT_MESSAGE_FILE_PATH"
echo "$remaining_lines" >> "$COMMIT_MESSAGE_FILE_PATH"
